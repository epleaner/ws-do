<!DOCTYPE html>
<html>
  <head>
    <title>MIDI FREQ</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    />
    <link rel="stylesheet" type="text/css" href="synth/styles.css" />
    <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script type="module" src="ws-monitor.js"></script>
  </head>

  <body>
    <div id="ws-monitor-container"></div>
    <script type="module">
      import WsClient from '../../utils/WsClient.js';
      import {observable, decorate} from 'mobx';
      import {render, html} from 'lit';

      decorate(WsClient, {
        ws: observable,
        wsUrl: observable,
        history: observable,
        heartbeat: observable,
        joinedChannels: observable,
        availableChannels: observable,
        id: observable,
        incomingMessage: observable,
        handleMessage: observable,
      });

      window.wsClient = new WsClient({
        handleMessage: (data) => {
          if (data.type === 'noteOut') {
            let [note, velocity] = data.data;
            if (velocity > 0) playSynth(note, velocity);
            else stopSynth(note);
          }
        },
      });

      const template = html`<ws-monitor
        .wsClient=${window.wsClient}
      ></ws-monitor>`;

      render(template, document.getElementById('ws-monitor-container'));
    </script>

    <div id="canvas"></div>

    <div id="device-select-container" style="display: none">
      <p>press shift+space to toggle controls</p>
      <label for="device-select">Select MIDI Device:</label>
      <select id="device-select"></select>
    </div>

    <script type="module" src="synth/audio.js"></script>
    <script type="module" src="synth/video.js"></script>
  </body>
</html>
