(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{QRet:function(e,n,t){"use strict";function o(e,n){k.options.__h&&k.options.__h(w,e,N||n),N=0;var t=w.__H||(w.__H={__:[],__h:[]});return e>=t.__.length&&t.__.push({__V:C}),t.__[e]}function i(e){return N=1,s(y,e)}function s(e,n,t){var i=o(O++,2);if(i.t=e,!i.__c&&(i.__=[t?t(n):y(void 0,n),function(e){var n=i.__N?i.__N[0]:i.__[0],t=i.t(n,e);n!==t&&(i.__N=[t,i.__[1]],i.__c.setState({}))}],i.__c=w,!w.u)){var s=function(e,n,t){if(!i.__c.__H)return!0;var o=i.__c.__H.__.filter((function(e){return e.__c}));if(o.every((function(e){return!e.__N})))return!c||c.call(this,e,n,t);var s=!1;return o.forEach((function(e){if(e.__N){var n=e.__[0];e.__=e.__N,e.__N=void 0,n!==e.__[0]&&(s=!0)}})),!(!s&&i.__c.props===e)&&(!c||c.call(this,e,n,t))};w.u=!0;var c=w.shouldComponentUpdate,a=w.componentWillUpdate;w.componentWillUpdate=function(e,n,t){if(this.__e){var o=c;c=void 0,s(e,n,t),c=o}a&&a.call(this,e,n,t)},w.shouldComponentUpdate=s}return i.__N||i.__}function c(e,n){var t=o(O++,3);!k.options.__s&&b(t.__H,n)&&(t.__=e,t.i=n,w.__H.__h.push(t))}function a(e,n){var t=o(O++,4);!k.options.__s&&b(t.__H,n)&&(t.__=e,t.i=n,w.__h.push(t))}function r(e){return N=5,u((function(){return{current:e}}),[])}function l(e,n,t){N=6,a((function(){return"function"==typeof e?(e(n()),function(){return e(null)}):e?(e.current=n(),function(){return e.current=null}):void 0}),null==t?t:t.concat(e))}function u(e,n){var t=o(O++,7);return b(t.__H,n)?(t.__V=e(),t.i=n,t.__h=e,t.__V):t.__}function _(e,n){return N=8,u((function(){return e}),n)}function d(e){var n=w.context[e.__c],t=o(O++,9);return t.c=e,n?(null==t.__&&(t.__=!0,n.sub(w)),n.props.value):e.__}function f(e,n){k.options.useDebugValue&&k.options.useDebugValue(n?n(e):e)}function h(){var e=o(O++,11);if(!e.__){for(var n=w.__v;null!==n&&!n.__m&&null!==n.__;)n=n.__;var t=n.__m||(n.__m=[0,0]);e.__="P"+t[0]+"-"+t[1]++}return e.__}function p(){for(var e;e=I.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(m),e.__H.__h.forEach(g),e.__H.__h=[]}catch(n){e.__H.__h=[],k.options.__e(n,e.__v)}}function v(e){var n,t=function(){clearTimeout(o),P&&cancelAnimationFrame(n),setTimeout(e)},o=setTimeout(t,100);P&&(n=requestAnimationFrame(t))}function m(e){var n=w,t=e.__c;"function"==typeof t&&(e.__c=void 0,t()),w=n}function g(e){var n=w;e.__c=e.__(),w=n}function b(e,n){return!e||e.length!==n.length||n.some((function(n,t){return n!==e[t]}))}function y(e,n){return"function"==typeof n?n(e):n}t.d(n,"a",(function(){return _})),t.d(n,"b",(function(){return d})),t.d(n,"c",(function(){return f})),t.d(n,"d",(function(){return c})),t.d(n,"e",(function(){return h})),t.d(n,"f",(function(){return l})),t.d(n,"g",(function(){return a})),t.d(n,"h",(function(){return u})),t.d(n,"i",(function(){return s})),t.d(n,"j",(function(){return r})),t.d(n,"k",(function(){return i}));var O,w,j,S,k=t("hosL"),N=0,I=[],C=[],D=k.options.__b,M=k.options.__r,H=k.options.diffed,E=k.options.__c,J=k.options.unmount;k.options.__b=function(e){w=null,D&&D(e)},k.options.__r=function(e){M&&M(e),O=0;var n=(w=e.__c).__H;n&&(j===w?(n.__h=[],w.__h=[],n.__.forEach((function(e){e.__N&&(e.__=e.__N),e.__V=C,e.__N=e.i=void 0}))):(n.__h.forEach(m),n.__h.forEach(g),n.__h=[],O=0)),j=w},k.options.diffed=function(e){H&&H(e);var n=e.__c;n&&n.__H&&(n.__H.__h.length&&(1!==I.push(n)&&S===k.options.requestAnimationFrame||((S=k.options.requestAnimationFrame)||v)(p)),n.__H.__.forEach((function(e){e.i&&(e.__H=e.i),e.__V!==C&&(e.__=e.__V),e.i=void 0,e.__V=C}))),j=w=null},k.options.__c=function(e,n){n.some((function(e){try{e.__h.forEach(m),e.__h=e.__h.filter((function(e){return!e.__||g(e)}))}catch(t){n.some((function(e){e.__h&&(e.__h=[])})),n=[],k.options.__e(t,e.__v)}})),E&&E(e,n)},k.options.unmount=function(e){J&&J(e);var n,t=e.__c;t&&t.__H&&(t.__H.__.forEach((function(e){try{m(e)}catch(e){n=e}})),t.__H=void 0,n&&k.options.__e(n,t.__v))};var P="function"==typeof requestAnimationFrame},RaXK:function(e,n,t){"use strict";(function(e,o){var i=t("QRet");n.a=({websocket:n})=>{const{ws:t,wsUrl:s,setWsUrl:c,history:a,myChannels:r,availableChannels:l,id:u,wsState:_,joinChannel:d,getChannels:f,heartbeat:h,broadcastMessage:p,sendMessageToTargetClient:v,sendMessageToTargetChannel:m,sendMessageToJoinedChannels:g}=n,[b,y]=Object(i.k)(""),[O,w]=Object(i.k)(""),[j,S]=Object(i.k)(""),k=Object(i.h)((()=>{try{JSON.parse(b)}catch(e){return!1}return!0}),[b]),N=Object(i.a)((e=>{e.preventDefault(),c(e.target.wsUrl.value)}),[c]);return e("div",{className:"flex flex-col gap-4"},e("div",{className:"flex gap-8"},t&&s&&e("div",null,_," on: ",s),e("form",{onSubmit:N},e("input",{type:"text",name:"wsUrl",placeholder:s}),e("button",{type:"submit"},"go"))),t&&e(o,null,e("div",null,u&&e("div",null,"id: ",u),h&&e("div",null,"heartbeat: ",JSON.stringify(h))),e("div",null,e("div",{className:"flex flex-row gap-8"},e("button",{onClick:f},"get channels"),e("form",{onSubmit:d},e("input",{type:"text",name:"channel"}),e("button",{type:"submit",className:"ml-2"},"join channel"))),e("ul",null,"my channels:",r.map((({channel:n,members:t})=>e("li",{key:n,className:"ml-2"},n," | ",t.length," members: ",t.join(", "))))),e("ul",null,"all channels:",l.map((({channel:n,members:t})=>e("li",{key:n,className:"ml-2"},n," ",t.length?`| ${t.length} members: ${t.join(", ")}`:"(no members)"))))),e("div",null,e("div",{className:"flex flex-col gap-1"},e("div",null,e("label",{htmlFor:"message"},"message"),e("textarea",{cols:100,rows:1,name:"message",placeholder:'{"hello": 1}',value:b,onInput:e=>y(e.target.value)})),e("div",null,e("label",{htmlFor:"targetChannel"},"target channel"),e("input",{name:"targetChannel",type:"text",value:O,onInput:e=>w(e.target.value)})),e("div",null,e("label",{htmlFor:"targetChannel"},"target client"),e("input",{name:"targetId",type:"text",value:j,onInput:e=>S(e.target.value)})),e("div",null,e("button",{disabled:!k,onClick:()=>v(b,j)},"send to another client"),e("button",{disabled:!k,onClick:()=>m(b,O)},"send to channel"),e("button",{disabled:!k,onClick:()=>g(b)},"send to joined channel"),e("button",{disabled:!k,onClick:()=>p(b)},"broadcast"))),!k&&b.length?e("div",null,"Invalid JSON"):e(o,null)),e("div",null,"incoming messages:"),e("div",{style:{overflow:"scroll",height:"200px"}},a.map((n=>e("div",{key:n},JSON.stringify(n)))))))}}).call(this,t("hosL").h,t("hosL").Fragment)},Zp5c:function(e,n,t){"use strict";function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,n||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:String(n)}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var c=t("QRet");n.a=()=>{const[e,n]=Object(c.k)(null),[t,o]=Object(c.k)(""),[s,a]=Object(c.k)([]),[r,l]=Object(c.k)(null),[u,_]=Object(c.k)([]),[d,f]=Object(c.k)([]),[h,p]=Object(c.k)(null),[v,m]=Object(c.k)(""),g=Object(c.a)((async e=>{const n=await JSON.parse(e.data);switch(n.type){case"id":p(n.id);break;case"heartbeat":l(n.heartbeat);break;case"myChannels":_(n.channels);break;case"availableChannels":f(n.channels);break;default:a((e=>[n,...e]))}m(n)}),[]);Object(c.d)((()=>{if(!window)return;const e=window.location.protocol.includes("https")?"wss":"ws",n=window.location.protocol.includes("https")?"":":3000";let t=`${e}://${location.hostname}${n}?channels=welcome`;o(t)}),[]),Object(c.d)((()=>{if(!t.length||"undefined"==typeof window)return;console.log("attempting to connect to",t),e&&e.close();const o=new WebSocket(t);o.onmessage=g,o.onopen=()=>{console.log("hey were open")},n(o)}),[g,t]);const b=Object(c.a)((()=>{null==e||e.send(JSON.stringify({type:"myChannels"})),null==e||e.send(JSON.stringify({type:"availableChannels"}))}),[e]),y=Object(c.h)((()=>{if("undefined"!=typeof window)switch(null==e?void 0:e.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"open";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"closed";default:return"uninitialized"}}),[null==e?void 0:e.readyState]);Object(c.d)((()=>{"open"===y&&b()}),[b,e,y]);const O=Object(c.a)((n=>{n.preventDefault(),null==e||e.send(JSON.stringify({type:"joinChannel",channel:n.target.channel.value}))}),[e]),w=Object(c.a)((n=>"open"===y&&(null==e?void 0:e.send(JSON.stringify({type:"broadcast",message:i(i({},JSON.parse(n)),{},{timestamp:Date.now()})})))),[e,y]),j=Object(c.a)(((n,t)=>{"open"===y&&(null==e||e.send(JSON.stringify(i(i({},JSON.parse(n)),{},{timestamp:Date.now(),channel:t}))))}),[e,y]),S=Object(c.a)(((n,t)=>{console.log("sending to target id",n,t),"open"===y&&(null==e||e.send(JSON.stringify(i(i({},JSON.parse(n)),{},{timestamp:Date.now(),targetId:t}))))}),[e,y]),k=Object(c.a)((n=>{"open"===y&&(null==e||e.send(JSON.stringify(i(i({},JSON.parse(n)),{},{timestamp:Date.now()}))))}),[e,y]);return{ws:e,wsUrl:t,setWsUrl:o,history:s,myChannels:u,availableChannels:d,id:h,incomingMessage:v,wsState:y,joinChannel:O,getChannels:b,heartbeat:r,broadcastMessage:w,sendMessageToTargetClient:S,sendMessageToTargetChannel:j,sendMessageToJoinedChannels:k}}},eoo9:function(e,n){"use strict";n.a={home:"home__1n+Tk",resource:"resource__Gnwfh"}},glPK:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));class o{constructor(e){console.log("Midihandler constructor",navigator),navigator.requestMIDIAccess().then(this.onMIDISuccess.bind(this),this.onMIDIFailure.bind(this)),this.synth=e}onMIDIMessage(e){const[n,t,o]=e.data;this.midiAccess.inputs.get(this.selectedDeviceId)===e.target&&(144===n&&o>0||128===n||144===n&&0===o)&&console.log("note on",t)}onMIDISuccess(e){this.midiAccess=e;const n=this.midiAccess.inputs.values(),t=document.getElementById("device-select");for(let e of n){const n=document.createElement("option");n.value=e.id,n.text=e.name,t.appendChild(n)}t.addEventListener("change",this.onDeviceSelect);for(let e of this.midiAccess.inputs.values())e.onmidimessage=this.onMIDIMessage}onMIDIFailure(){console.log("Failed to access MIDI devices")}onDeviceSelect(e){this.selectedDeviceId=e.target.value,navigator.requestMIDIAccess().then((e=>{for(let n of e.inputs.values())n.onmidimessage=null;for(let e of this.synth.voices)e.stop();this.synth.voices=[];const n=e.inputs.get(this.selectedDeviceId);n&&(n.onmidimessage=this.onMIDIMessage)}))}setupKeyboardListener(){document.addEventListener("keydown",(e=>{e.shiftKey&&"Space"===e.code&&this.toggleMIDIDeviceSelect()}))}toggleMIDIDeviceSelect(){const e=document.getElementById("device-select-container");e&&(e.style.display="none"===e.style.display?"block":"none")}}},rdXU:function(e,n,t){"use strict";t.r(n),function(e){var o=t("eoo9"),i=t("w+Gk");n.default=()=>e("div",{class:o.a.home},e(i.a,null))}.call(this,t("hosL").h)},"w+Gk":function(e,n,t){"use strict";(function(e){var o=t("QRet"),i=t("glPK"),s=t("Zp5c"),c=t("RaXK");n.a=()=>{const n=Object(s.a)(),[,t]=Object(o.k)(null);return Object(o.d)((()=>{window&&navigator&&t(new i.a)}),[]),e("div",null,e(c.a,{websocket:n}),e("div",{id:"device-select-container",style:"display: block;"},e("p",null,"press shift+space to toggle controls"),e("label",{for:"device-select"},"Select MIDI Device:"),e("select",{id:"device-select"})))}}).call(this,t("hosL").h)}}]);
//# sourceMappingURL=route-midi.chunk.85b00.esm.js.map