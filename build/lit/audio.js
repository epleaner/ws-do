let t,e;navigator.requestMIDIAccess().then((function(e){t=e;const o=t.inputs.values(),n=document.getElementById("device-select");for(let t of o){const e=document.createElement("option");e.value=t.id,e.text=t.name,n.appendChild(e)}n.addEventListener("change",a);for(let e of t.inputs.values())e.onmidimessage=c}),(function(){console.log("Failed to access MIDI devices")}));const o=new(window.AudioContext||window.webkitAudioContext);function n(){this.voices=[]}function i(t,e,o){this.audioContext=t,this.note=e,this.velocity=o,this.oscillator=this.audioContext.createOscillator(),this.oscillator.frequency.value=function(t){return 440*Math.pow(2,(t-69)/12)}(e),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=o/127,this.oscillator.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination)}n.prototype.playNote=function(t,e){console.log("playing note");const n=new i(o,t,e);this.voices.push(n),n.start()},n.prototype.stopNote=function(t){console.log("stopping note");const e=this.voices.findIndex((e=>e.note===t));if(-1!==e){this.voices[e].stop(),this.voices.splice(e,1)}},i.prototype.start=function(){this.oscillator.start()},i.prototype.stop=function(){this.gainNode.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+.5),this.oscillator.stop(this.audioContext.currentTime+.5)};const s=new n;function c(o){console.log("midi message",o);const[n,i,c]=o.data;t.inputs.get(e)===o.target&&(console.log("its target"),144===n&&c>0?function(t,e){s.playNote(t,e)}(i,c):(128===n||144===n&&0===c)&&function(t){s.stopNote(t)}(i))}function a(t){e=t.target.value,navigator.requestMIDIAccess().then((function(t){for(let e of t.inputs.values())e.onmidimessage=null;for(let t of s.voices)t.stop();s.voices=[];const o=t.inputs.get(e);o&&(o.onmidimessage=c)}))}document.addEventListener("keydown",(function(t){t.shiftKey&&"Space"===t.code&&function(){const t=document.getElementById("device-select-container");"none"===t.style.display?t.style.display="block":t.style.display="none"}()}));
