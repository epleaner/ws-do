(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{QRet:function(e,t,n){"use strict";function o(e,t){k.options.__h&&k.options.__h(w,e,N||t),N=0;var n=w.__H||(w.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({__V:C}),n.__[e]}function i(e){return N=1,s(y,e)}function s(e,t,n){var i=o(O++,2);if(i.t=e,!i.__c&&(i.__=[n?n(t):y(void 0,t),function(e){var t=i.__N?i.__N[0]:i.__[0],n=i.t(t,e);t!==n&&(i.__N=[n,i.__[1]],i.__c.setState({}))}],i.__c=w,!w.u)){var s=function(e,t,n){if(!i.__c.__H)return!0;var o=i.__c.__H.__.filter((function(e){return e.__c}));if(o.every((function(e){return!e.__N})))return!c||c.call(this,e,t,n);var s=!1;return o.forEach((function(e){if(e.__N){var t=e.__[0];e.__=e.__N,e.__N=void 0,t!==e.__[0]&&(s=!0)}})),!(!s&&i.__c.props===e)&&(!c||c.call(this,e,t,n))};w.u=!0;var c=w.shouldComponentUpdate,a=w.componentWillUpdate;w.componentWillUpdate=function(e,t,n){if(this.__e){var o=c;c=void 0,s(e,t,n),c=o}a&&a.call(this,e,t,n)},w.shouldComponentUpdate=s}return i.__N||i.__}function c(e,t){var n=o(O++,3);!k.options.__s&&g(n.__H,t)&&(n.__=e,n.i=t,w.__H.__h.push(n))}function a(e,t){var n=o(O++,4);!k.options.__s&&g(n.__H,t)&&(n.__=e,n.i=t,w.__h.push(n))}function r(e){return N=5,u((function(){return{current:e}}),[])}function l(e,t,n){N=6,a((function(){return"function"==typeof e?(e(t()),function(){return e(null)}):e?(e.current=t(),function(){return e.current=null}):void 0}),null==n?n:n.concat(e))}function u(e,t){var n=o(O++,7);return g(n.__H,t)?(n.__V=e(),n.i=t,n.__h=e,n.__V):n.__}function _(e,t){return N=8,u((function(){return e}),t)}function d(e){var t=w.context[e.__c],n=o(O++,9);return n.c=e,t?(null==n.__&&(n.__=!0,t.sub(w)),t.props.value):e.__}function f(e,t){k.options.useDebugValue&&k.options.useDebugValue(t?t(e):e)}function h(){var e=o(O++,11);if(!e.__){for(var t=w.__v;null!==t&&!t.__m&&null!==t.__;)t=t.__;var n=t.__m||(t.__m=[0,0]);e.__="P"+n[0]+"-"+n[1]++}return e.__}function p(){for(var e;e=I.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(m),e.__H.__h.forEach(b),e.__H.__h=[]}catch(t){e.__H.__h=[],k.options.__e(t,e.__v)}}function v(e){var t,n=function(){clearTimeout(o),P&&cancelAnimationFrame(t),setTimeout(e)},o=setTimeout(n,100);P&&(t=requestAnimationFrame(n))}function m(e){var t=w,n=e.__c;"function"==typeof n&&(e.__c=void 0,n()),w=t}function b(e){var t=w;e.__c=e.__(),w=t}function g(e,t){return!e||e.length!==t.length||t.some((function(t,n){return t!==e[n]}))}function y(e,t){return"function"==typeof t?t(e):t}n.d(t,"a",(function(){return _})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return f})),n.d(t,"d",(function(){return c})),n.d(t,"e",(function(){return h})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return a})),n.d(t,"h",(function(){return u})),n.d(t,"i",(function(){return s})),n.d(t,"j",(function(){return r})),n.d(t,"k",(function(){return i}));var O,w,j,S,k=n("hosL"),N=0,I=[],C=[],D=k.options.__b,M=k.options.__r,H=k.options.diffed,E=k.options.__c,J=k.options.unmount;k.options.__b=function(e){w=null,D&&D(e)},k.options.__r=function(e){M&&M(e),O=0;var t=(w=e.__c).__H;t&&(j===w?(t.__h=[],w.__h=[],t.__.forEach((function(e){e.__N&&(e.__=e.__N),e.__V=C,e.__N=e.i=void 0}))):(t.__h.forEach(m),t.__h.forEach(b),t.__h=[],O=0)),j=w},k.options.diffed=function(e){H&&H(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(1!==I.push(t)&&S===k.options.requestAnimationFrame||((S=k.options.requestAnimationFrame)||v)(p)),t.__H.__.forEach((function(e){e.i&&(e.__H=e.i),e.__V!==C&&(e.__=e.__V),e.i=void 0,e.__V=C}))),j=w=null},k.options.__c=function(e,t){t.some((function(e){try{e.__h.forEach(m),e.__h=e.__h.filter((function(e){return!e.__||b(e)}))}catch(n){t.some((function(e){e.__h&&(e.__h=[])})),t=[],k.options.__e(n,e.__v)}})),E&&E(e,t)},k.options.unmount=function(e){J&&J(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach((function(e){try{m(e)}catch(e){t=e}})),n.__H=void 0,t&&k.options.__e(t,n.__v))};var P="function"==typeof requestAnimationFrame},RaXK:function(e,t,n){"use strict";(function(e,o){var i=n("QRet");t.a=({websocket:t})=>{const{ws:n,wsUrl:s,setWsUrl:c,history:a,myChannels:r,availableChannels:l,id:u,wsState:_,joinChannel:d,getChannels:f,heartbeat:h,broadcastMessage:p,sendMessageToTargetClient:v,sendMessageToTargetChannel:m,sendMessageToJoinedChannels:b}=t,[g,y]=Object(i.k)(""),[O,w]=Object(i.k)(""),[j,S]=Object(i.k)(""),k=Object(i.h)((()=>{try{JSON.parse(g)}catch(e){return!1}return!0}),[g]),N=Object(i.a)((e=>{e.preventDefault(),c(e.target.wsUrl.value)}),[c]);return e("div",{className:"flex flex-col gap-4"},e("div",{className:"flex gap-8"},e("div",null,_),n&&s&&e("div",null,"connected to: ",s),e("form",{onSubmit:N},e("input",{type:"text",name:"wsUrl",placeholder:s}),e("button",{type:"submit"},"go"))),n&&e(o,null,e("div",null,u&&e("div",null,"id: ",u),h&&e("div",null,"heartbeat: ",JSON.stringify(h))),e("div",null,e("div",{className:"flex flex-row gap-8"},e("button",{onClick:f},"get channels"),e("form",{onSubmit:d},e("input",{type:"text",name:"channel"}),e("button",{type:"submit",className:"ml-2"},"join channel"))),e("ul",null,"my channels:",r.map((({channel:t,members:n})=>e("li",{key:t,className:"ml-2"},t," | ",n.length," members: ",n.join(", "))))),e("ul",null,"all channels:",l.map((({channel:t,members:n})=>e("li",{key:t,className:"ml-2"},t," ",n.length?`| ${n.length} members: ${n.join(", ")}`:"(no members)"))))),e("div",null,e("div",{className:"flex flex-col gap-1"},e("div",null,e("label",{htmlFor:"message"},"message"),e("textarea",{cols:100,rows:1,name:"message",placeholder:'{"hello": 1}',value:g,onInput:e=>y(e.target.value)})),e("div",null,e("label",{htmlFor:"targetChannel"},"target channel"),e("input",{name:"targetChannel",type:"text",value:O,onInput:e=>w(e.target.value)})),e("div",null,e("label",{htmlFor:"targetChannel"},"target client"),e("input",{name:"targetId",type:"text",value:j,onInput:e=>S(e.target.value)})),e("div",null,e("button",{disabled:!k,onClick:()=>v(g,j)},"send to another client"),e("button",{disabled:!k,onClick:()=>m(g,O)},"send to channel"),e("button",{disabled:!k,onClick:()=>b(g)},"send to joined channel"),e("button",{disabled:!k,onClick:()=>p(g)},"broadcast"))),!k&&g.length?e("div",null,"Invalid JSON"):e(o,null)),e("div",null,"incoming messages:"),e("div",{style:{overflow:"scroll",height:"200px"}},a.map((t=>e("div",{key:t},JSON.stringify(t)))))))}}).call(this,n("hosL").h,n("hosL").Fragment)},Zp5c:function(e,t,n){"use strict";function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=n("QRet");t.a=()=>{const[e,t]=Object(c.k)(null),[n,o]=Object(c.k)(""),[s,a]=Object(c.k)([]),[r,l]=Object(c.k)(null),[u,_]=Object(c.k)([]),[d,f]=Object(c.k)([]),[h,p]=Object(c.k)(null),[v,m]=Object(c.k)(""),b=Object(c.a)((async e=>{const t=await JSON.parse(e.data);switch(t.type){case"id":p(t.id);break;case"heartbeat":l(t.heartbeat);break;case"myChannels":_(t.channels);break;case"availableChannels":f(t.channels);break;default:a((e=>[t,...e]))}m(t)}),[]);Object(c.d)((()=>{if(!window)return;const e=window.location.protocol.includes("https")?"wss":"ws",t=window.location.protocol.includes("https")?"":":8081",n=`${e}://${location.hostname}${t}?channels=welcome`;o(n)}),[]),Object(c.d)((()=>{if(!n.length||"undefined"==typeof window)return;console.log("attempting to connect to",n);const e=new WebSocket(n);e.onmessage=b,t(e)}),[b,n]);const g=Object(c.a)((()=>{null==e||e.send(JSON.stringify({type:"myChannels"})),null==e||e.send(JSON.stringify({type:"availableChannels"}))}),[e]),y=Object(c.h)((()=>{if("undefined"!=typeof window)switch(null==e?void 0:e.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"open";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"closed";default:return"uninitialized"}}),[null==e?void 0:e.readyState]);Object(c.d)((()=>{"open"===y&&g()}),[g,e,y]);const O=Object(c.a)((t=>{t.preventDefault(),null==e||e.send(JSON.stringify({type:"joinChannel",channel:t.target.channel.value}))}),[e]),w=Object(c.a)((t=>"open"===y&&(null==e?void 0:e.send(JSON.stringify({type:"broadcast",message:i(i({},JSON.parse(t)),{},{timestamp:Date.now()})})))),[e,y]),j=Object(c.a)(((t,n)=>{"open"===y&&(null==e||e.send(JSON.stringify(i(i({},JSON.parse(t)),{},{timestamp:Date.now(),channel:n}))))}),[e,y]),S=Object(c.a)(((t,n)=>{console.log("sending to target id",t,n),"open"===y&&(null==e||e.send(JSON.stringify(i(i({},JSON.parse(t)),{},{timestamp:Date.now(),targetId:n}))))}),[e,y]),k=Object(c.a)((t=>{"open"===y&&(null==e||e.send(JSON.stringify(i(i({},JSON.parse(t)),{},{timestamp:Date.now()}))))}),[e,y]);return{ws:e,wsUrl:n,setWsUrl:o,history:s,myChannels:u,availableChannels:d,id:h,incomingMessage:v,wsState:y,joinChannel:O,getChannels:g,heartbeat:r,broadcastMessage:w,sendMessageToTargetClient:S,sendMessageToTargetChannel:j,sendMessageToJoinedChannels:k}}},eoo9:function(e,t){"use strict";t.a={home:"home__1n+Tk",resource:"resource__Gnwfh"}},glPK:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));class o{constructor(e){console.log("Midihandler constructor",navigator),navigator.requestMIDIAccess().then(this.onMIDISuccess.bind(this),this.onMIDIFailure.bind(this)),this.synth=e}onMIDIMessage(e){const[t,n,o]=e.data;this.midiAccess.inputs.get(this.selectedDeviceId)===e.target&&(144===t&&o>0||128===t||144===t&&0===o)&&console.log("note on",n)}onMIDISuccess(e){this.midiAccess=e;const t=this.midiAccess.inputs.values(),n=document.getElementById("device-select");for(let e of t){const t=document.createElement("option");t.value=e.id,t.text=e.name,n.appendChild(t)}n.addEventListener("change",this.onDeviceSelect);for(let e of this.midiAccess.inputs.values())e.onmidimessage=this.onMIDIMessage}onMIDIFailure(){console.log("Failed to access MIDI devices")}onDeviceSelect(e){this.selectedDeviceId=e.target.value,navigator.requestMIDIAccess().then((e=>{for(let t of e.inputs.values())t.onmidimessage=null;for(let e of this.synth.voices)e.stop();this.synth.voices=[];const t=e.inputs.get(this.selectedDeviceId);t&&(t.onmidimessage=this.onMIDIMessage)}))}setupKeyboardListener(){document.addEventListener("keydown",(e=>{e.shiftKey&&"Space"===e.code&&this.toggleMIDIDeviceSelect()}))}toggleMIDIDeviceSelect(){const e=document.getElementById("device-select-container");e&&(e.style.display="none"===e.style.display?"block":"none")}}},rdXU:function(e,t,n){"use strict";n.r(t),function(e){var o=n("eoo9"),i=n("w+Gk");t.default=()=>e("div",{class:o.a.home},e(i.a,null))}.call(this,n("hosL").h)},"w+Gk":function(e,t,n){"use strict";(function(e){var o=n("QRet"),i=n("glPK"),s=n("Zp5c"),c=n("RaXK");t.a=()=>{const t=Object(s.a)(),[,n]=Object(o.k)(null);return Object(o.d)((()=>{window&&navigator&&n(new i.a)}),[]),e("div",null,e(c.a,{websocket:t}),e("div",{id:"device-select-container",style:"display: block;"},e("p",null,"press shift+space to toggle controls"),e("label",{for:"device-select"},"Select MIDI Device:"),e("select",{id:"device-select"})))}}).call(this,n("hosL").h)}}]);
//# sourceMappingURL=route-midi.chunk.04982.esm.js.map